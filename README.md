# PANTHER Challenge: Pancreatic Tumor Segmentation

This repository contains the code and resources for the PANTHER Challenge, which is focused on the segmentation of pancreatic tumors from MRI scans. The challenge is divided into two distinct tasks, each with its own approach and objectives.

-----

## Task 1: 3-Class Pancreas and Tumor Segmentation

Task 1 is a multi-class segmentation problem where the goal is to identify and delineate three distinct regions in an MRI scan: the pancreas, the pancreatic tumor, and the background. This task serves as the foundation for the more specialized Task 2.

### Approach

The solution for Task 1 is built upon the **nnU-Net framework**, a powerful and adaptable deep learning pipeline for medical image segmentation. The core of this solution is a **Residual Encoder U-Net (ResEncUNet)**, which is a variant of the widely used U-Net architecture.

The training process, detailed in `Task1/train_task1_demo.py`, employs a 5-fold cross-validation strategy to ensure the model's robustness and generalizability. A custom nnU-Net trainer, `nnUNetTrainer_Student`, is used to manage the training process.

For inference, the final segmentation is generated by a **5-fold ensemble** of the trained models. This means that five separate models, each trained on a different fold of the data, are used to make predictions. These predictions are then combined to produce a single, more accurate segmentation map.

### How to Run Task 1

The Task 1 solution is containerized using Docker to ensure reproducibility. To build and run the solution, you can use the provided shell scripts:

1.  **Build the Docker image:**
    ```bash
    ./Task1/do_build.sh
    ```
2.  **Run the inference pipeline on test data:**
    ```bash
    ./Task1/do_test_run.sh
    ```
3.  **Save the Docker image for deployment:**
    ```bash
    ./Task1/do_save.sh
    ```

-----

## Task 2: Binary Tumor-Only Segmentation

Task 2 narrows the focus to a binary segmentation problem: identifying only the pancreatic tumor. This task builds directly on the model developed in Task 1, using a technique called **fine-tuning** to adapt the existing model to this more specific objective.

### Approach

The solution for Task 2 employs a two-stage approach to improve accuracy and efficiency:

1.  **Pancreas Localization:** The process begins by using **`mrsegmentator`**, a tool designed for multi-organ segmentation, to identify the location of the pancreas in the MRI scan.
2.  **Image Cropping:** Once the pancreas is located, the MRI image is cropped to this specific region of interest. This step reduces the computational overhead and allows the segmentation model to focus on the area most likely to contain the tumor.
3.  **Tumor Segmentation:** A **fine-tuned nnU-Net model** is then used to segment the tumor within the cropped image. This model is not trained from scratch; instead, it is adapted from the 3-class model developed in Task 1. This transfer learning approach allows the model to leverage the knowledge it has already gained about the anatomy of the pancreas and surrounding tissues.

The training script, `Task2/train_task2_demo.py`, details the process of fine-tuning the Task 1 model for this binary segmentation task.

### How to Run Task 2

Like Task 1, the Task 2 solution is also containerized using Docker. The following scripts can be used to build and run the solution:

1.  **Build the Docker image:**
    ```bash
    ./Task2/do_build.sh
    ```
2.  **Run the inference pipeline on test data:**
    ```bash
    ./Task2/do_test_run.sh
    ```
3.  **Save the Docker image for deployment:**
    ```bash
    ./Task2/do_save.sh
    ```
